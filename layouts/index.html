{{- define "main" }}
<div class="wrapper">
    <section class="home-about">
        <a href="/about/" class="no-underline" id="MattWalker-Logo">
            <img src="/images/MattWalker-avatar.png" alt="Illustrated avatar of Matt Walker" class="avatar" />
        </a>
        <div class="home-about-text">
            <p>Hey, I'm <a href="/about/">Matt Walker</a>.</p>
            <p>I'm a software engineer in the Baltimore/DC Metro area.
                This site is mostly for me to learn and test things out.
                It's also an archive of tech, hobby and travel related journal posts I have collected along the way.</p>
            <p>Here is some of the <a href="/gear/">gear I use</a> and what I am up to <a href="/now/">now</a>.</p>
        </div>
    </section>
</div>
<div class="wrapper full">
    <hr />
</div>
<div class="wrapper">
    <section class="home-journal">
        <h2>Journal</h2>
        <ul class="header-list">
            <li><a href="/posts/">Everything</a></li>
            <li><a href="/tags/software-development/">Software Dev</a></li>
            <li><a href="/tags/travel/">Travel</a></li>
        </ul>
        <ul class="posts">
            {{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
            {{- range first 5 $pages }}
            <li>
                <a href="{{ .RelPermalink }}">{{ .Title }}</a> - <span class="date">{{ .Date.Format "January 2, 2006" }}</span>
            </li>
            {{- end }}
        </ul>
    </section>
</div>
{{- $photos := where (where site.RegularPages "Section" "photography") ".Params.draft" "ne" true }}
{{- if gt (len $photos) 0 }}
<div class="wrapper full">
    <hr />
</div>
<div class="wrapper full">
    <section class="home-photography">
        <h2>Photography</h2>
        <div class="photo-strip">
            {{- range first 7 $photos }}
            {{- $img := .Resources.GetMatch "*.{jpg,jpeg,png,webp}" }}
            {{- if $img }}
            <a href="{{ $img.RelPermalink }}" class="photo-thumb-link no-underline"
               data-slug="{{ .File.ContentBaseName }}"
               data-alt="{{ with .Params.alt }}{{ . }}{{ else }}{{ .Title }}{{ end }}"
               data-title="{{ .Title }}"
               data-description="{{ .Params.description }}">
                {{- $thumb := $img.Fill "300x300 q85" }}
                <img src="{{ $thumb.RelPermalink }}" alt="{{ with .Params.alt }}{{ . }}{{ else }}{{ .Title }}{{ end }}" class="photo-thumb" loading="lazy" />
            </a>
            {{- end }}
            {{- end }}
            <a href="/photography/" class="gallery-link no-underline" aria-label="View all photos">
                <span>Gallery &rarr;</span>
            </a>
        </div>
    </section>
</div>
<div id="lightbox" class="lightbox-overlay" aria-hidden="true">
    <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
    <div class="lightbox-content">
        <div class="lightbox-header">
            <a href="/" class="lightbox-site-title">Matt Walker</a>
            <div class="lightbox-subtitle">Photography</div>
            <hr class="lightbox-header-rule" />
        </div>
        <div class="lightbox-img-wrap">
            <img class="lightbox-img" src="" alt="" />
            <div class="lightbox-nav lightbox-nav-prev" aria-label="Previous photo">&#8249;</div>
            <div class="lightbox-nav lightbox-nav-next" aria-label="Next photo">&#8250;</div>
        </div>
        <div class="lightbox-title"></div>
        <hr class="lightbox-rule" />
        <div class="lightbox-description"></div>
    </div>
</div>
<script>
(function() {
    var overlay = document.getElementById('lightbox');
    var img = overlay.querySelector('.lightbox-img');
    var titleEl = overlay.querySelector('.lightbox-title');
    var descEl = overlay.querySelector('.lightbox-description');
    var closeBtn = overlay.querySelector('.lightbox-close');
    var navPrev = overlay.querySelector('.lightbox-nav-prev');
    var navNext = overlay.querySelector('.lightbox-nav-next');
    var ruleEl = overlay.querySelector('.lightbox-rule');
    var headerRuleEl = overlay.querySelector('.lightbox-header-rule');
    var links = Array.from(document.querySelectorAll('.photo-thumb-link'));
    var currentIndex = -1;

    function syncRuleWidths() {
        var w = img.offsetWidth + 'px';
        ruleEl.style.width = w;
        headerRuleEl.style.width = w;
    }

    function showPhoto(index) {
        if (index < 0 || index >= links.length) return;
        currentIndex = index;
        var link = links[index];
        img.src = link.href;
        img.alt = link.dataset.alt || '';
        titleEl.textContent = link.dataset.title || '';
        descEl.textContent = link.dataset.description || '';
        titleEl.style.display = link.dataset.title ? '' : 'none';
        descEl.style.display = link.dataset.description ? '' : 'none';
        navPrev.style.visibility = index > 0 ? 'visible' : 'hidden';
        navNext.style.visibility = index < links.length - 1 ? 'visible' : 'hidden';
        img.onload = syncRuleWidths;
        if (link.dataset.slug) {
            history.replaceState(null, '', '#' + link.dataset.slug);
        }
    }

    links.forEach(function(link, i) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            showPhoto(i);
            overlay.classList.add('active');
            overlay.setAttribute('aria-hidden', 'false');
        });
    });

    function closeLightbox() {
        var slug = currentIndex >= 0 && links[currentIndex] ? links[currentIndex].dataset.slug : '';
        window.location.href = '/photography/' + (slug ? '#' + slug : '');
    }

    navPrev.addEventListener('click', function(e) {
        e.stopPropagation();
        if (currentIndex > 0) showPhoto(currentIndex - 1);
    });

    navNext.addEventListener('click', function(e) {
        e.stopPropagation();
        if (currentIndex < links.length - 1) showPhoto(currentIndex + 1);
    });

    closeBtn.addEventListener('click', closeLightbox);
    overlay.addEventListener('click', function(e) {
        if (e.target === img) return;
        if (e.target.closest('.lightbox-nav')) return;
        if (e.target.closest('.lightbox-site-title')) return;
        closeLightbox();
    });
    document.addEventListener('keydown', function(e) {
        if (!overlay.classList.contains('active')) return;
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowLeft' && currentIndex > 0) showPhoto(currentIndex - 1);
        if (e.key === 'ArrowRight' && currentIndex < links.length - 1) showPhoto(currentIndex + 1);
    });
})();
</script>
{{- end }}
{{- end }}
